Community Compass - Application Overview

Purpose
A glassmorphic, animated React web app that helps people discover, explore, and submit community resources. It features authentication, favorites, an interactive map with real coordinates and density visualization, and a clean API backed by Neon Postgres on Cloudflare Workers (Hono).

Top-level Architecture
- Frontend (src/react-app): React 19 + TypeScript + Tailwind + Framer Motion, React Router
- Backend (src/worker): Cloudflare Workers + Hono, Neon serverless Postgres
- Shared Types (src/shared): Zod schemas shared between client and server
- Build tooling: Vite, Tailwind, ESLint, TypeScript

Routing & Pages
- src/react-app/App.tsx: App router; mounts Navbar and Footer and defines routes.
  - /                → Home (spotlight resources, hero, CTA)
  - /discover        → Search/filter resources; favorites filter; modal detail view
  - /map             → Leaflet map with real coordinates and density view
  - /submit          → Auth-gated resource submission (via Clerk)
  - /references      → Documentation, licenses, and work log timeline
  - /about           → About page with vision, mission, values, and CTA
  - /sign-in         → Custom sign-in with Clerk hooks (password + email code fallback)
  - /sign-up         → Custom sign-up with Clerk hooks + email verification

Frontend Components
- components/Navbar.tsx: Glassy, animated top navigation. Handles auth state; links to sign-in/up or user menu.
- components/Footer.tsx: Company-style footer with vision, quick links, and contact info.
- components/GlassCard.tsx: Reusable glassmorphism container supporting variants and hover animations.
- components/GlassButton.tsx: Styled glass buttons with variants and sizes.
- components/AnimatedCompass.tsx: Hero animation.
- components/ResourceDetailModal.tsx: Rich resource detail modal with contact, tags, and actions.
- components/MapComponent.tsx: Leaflet map; categories → custom markers; shows markers with real lat/lng; density view renders zoom-aware circles and cluster summaries.

Frontend Pages
- pages/Home.tsx: Hero, spotlight resources, CTAs, modal integration.
- pages/Discover.tsx: Search, category chips, filters, favorites toggle, grid of GlassCards, detail modal.
- pages/Map.tsx: Fetches resources, recenters to user location (high-accuracy geolocation), toggles density view.
- pages/Submit.tsx: Requires auth; shows friendly sign-in prompt if signed out.
- pages/References.tsx: Licenses/attributions, tech stack, and work log timeline (since Sept 2024).
- pages/About.tsx: Vision, mission, values, and CTAs.
- pages/auth/SignIn.tsx: Custom Clerk sign-in with password; automatic email-code fallback and code verify flow.
- pages/auth/SignUp.tsx: Custom Clerk sign-up; collects name + password; verifies email via code.

Styling & Theme
- index.css: Tailwind directives and custom CSS variables/utilities for glassmorphism.
- hooks/useScrollAnimation.ts: Shared animation hook(s) (if used by pages/components).

Shared Types
- shared/types.ts: Zod ResourceSchema and submission schema; includes optional latitude/longitude; exported types and category list.

Backend (Hono on Workers)
- worker/index.ts: REST API
  - GET /api/resources            → List resources with filters (q, category, featured)
  - GET /api/resources/:id        → Fetch a single resource
  - GET /api/stats                → Resource and submission counts + category distribution
  - POST /api/submissions         → Accept resource submissions (validated via Zod)
  - POST /api/migrate             → Idempotent Neon schema setup/migration
  - GET /api/favorites?userId     → Return array of resource IDs favorited by the user
  - POST /api/favorites           → Body: { userId, resourceId } (idempotent insert)
  - DELETE /api/favorites/:id     → Query: userId; removes a favorite
  - POST /api/seed                → Inserts ~60 sample resources worldwide with lat/lng

- worker/migrate.ts: Creates tables if not exists:
  - resources(id, title, description, category, tags, address, city, state, zip, phone, email, website, hours, audience, services, image_url, latitude, longitude, is_featured, is_approved, created_at, updated_at)
  - resource_submissions(...)
  - favorites(id, user_id, resource_id, created_at, UNIQUE(user_id, resource_id))

- worker/types.ts: Worker Env bindings (e.g., NEON_DATABASE_URL) and type context.

Neon & Data
- uses @neondatabase/serverless to connect to Postgres.
- resources now include latitude/longitude for accurate mapping.
- favorites mapped per Clerk user id; simple REST interface (client passes userId).

Map Behavior
- Centers to user location (high accuracy) with fallback to default.
- Resource markers use actual lat/lng when available.
- Density view renders normalized circles that grow/merge at lower zooms; popups summarize counts.

Auth Behavior (Clerk)
- Custom Sign In: attempts password sign-in; on failure, falls back to email_code, prompting user to enter the emailed code. On success, session is activated and user redirected.
- Custom Sign Up: creates user with email verification; then activates session and redirects.
- Navbar and protected Submit page respond to auth state.

Favorites UX
- Heart toggle on cards (Discover) for signed-in users.
- Favorites filter button alongside Search/Filters.

Data Seeding
- POST /api/seed generates ~60 global resources with slight coordinate jitter.

Notes & Future Hardening
- Favorites endpoints trust a userId provided by the client. For production, add JWT verification/middleware to validate Clerk session on the worker.
- Consider server-side geocoding for any legacy rows with missing coordinates.
